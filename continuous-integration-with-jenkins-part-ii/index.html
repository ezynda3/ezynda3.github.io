<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Ed Zynda - Coder, Hacker, Superhero</title>

  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/agate.min.css">
</head>
<body>
  <nav class="red accent-3" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo"><i class="large material-icons">home</i></a>
    </div>
  </nav>
  <div class="parallax-container">
    <br>
    <br>
    <br>
    <br>
    <h1 class="header center white-text text-lighten-2">Ed Zynda</h1>
    <h3 class="header center white-text text-lighten-2">Coder | Hacker | Superhero</h3>
    <div class="parallax"><img src="/images/parallax.png"></div>
  </div>


<div class="section white container">
  <div class="row">
    <div class="col s8">
      
  
  <h2><a href="http://edzynda.com/continuous-integration-with-jenkins-part-ii/" title="Continuous Integration With Jenkins Part II">Continuous Integration With Jenkins Part II</a></h2>

  Posted on
  <time datetime="Mar 03, 2015">March 03, 2015</time>
  
    &middot; Tagged in
        
        <div class="chip"><a href="http://edzynda.com/tags/php">php</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/ci">ci</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/jenkins">jenkins</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/phpspec">phpspec</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/robo">robo</a></div>
        
    
  

      <p>In the <a href="/continuous-integration-with-jenkins-part-ii/">first part</a>  of this series, I showed you how you can easily set up a project to run automated tests using Jenkins. The quickest and easiest way to build your project and run tests is to add a build step that runs a bunch of shell commands. This is fine for small projects but what about larger projects with complex build steps and dependencies?</p>

<p>A better options is to use another tool to automate the build process and perform certain tasks dynamically. There are quite a lot of tools out there to do this. A popular tool used in Jenkins setups is <a href="http://ant.apache.org/">Apache Ant</a> . It&rsquo;s used a lot by Java developers to automate builds of their applications but can also be used to build and run tasks for just about anything.</p>

<p>I was planning to do this article about Ant but decided against it. While Ant is a very powerful tool, it&rsquo;s configuration is in XML which is just gross. Don&rsquo;t get me wrong, XML has it&rsquo;s uses but I prefer something more readable. Instead, I found a PHP based tool called <a href="http://robo.li">Robo</a>  which, in my opinion, is easier on the eyes and can be just as powerful.</p>

<p>If you still want to try out Ant you can check out a great example build file <a href="http://jenkins-php.org/automation.html">here</a>. Don&rsquo;t say I didn&rsquo;t warn you though.</p>

<p>So what is robo? Here is what they say on their website.</p>

<p><em>&ldquo;Robo is a task runner you always have been looking for. It allows you to write fully customizable tasks in common OOP PHP style. Robo has comprehensive list of built-in common tasks for development, testing, and deployment.&rdquo;</em></p>

<p>Installing and running robo tasks is really simple. It can be installed using Composer.</p>

<pre><code class="language-sh">$ composer require codegyre/robo
</code></pre>

<p>Once installed just run the command.</p>

<pre><code class="language-sh">$ vendor/bin/robo
</code></pre>

<p>If it&rsquo;s your first time running, it will create a file called &lsquo;RoboFile.php&rsquo;. This is the file we will use to define our commands and run our tasks.</p>

<p>Let&rsquo;s create a RoboFile for building and running some tests for a project.</p>

<pre><code class="language-php">&lt;?php
class RoboFile extends \Robo\Tasks
{
    // Run ALL the tasks
    public function build()
    {
        $this-&gt;setup();
        $this-&gt;test();
        $this-&gt;lint();
        $this-&gt;codesniffer();
    }

    // Setup
    private function setup()
    {
        if (! is_dir('reports')) {
            $this-&gt;taskFilesystemStack()
                -&gt;mkdir('reports')
                -&gt;run();
        }

        $this-&gt;_cleanDir('reports');
    }

    // Run PHPSpec tests
    public function test()
    {
        $this-&gt;taskPhpspec()
            -&gt;format('html')
            -&gt;arg('&gt; reports/phpspec.html')
            -&gt;run();
    }

    // Check for syntax errors
    public function lint()
    {
        $this-&gt;taskExec('php')
            -&gt;arg('-l')
            -&gt;arg('spec/*/*')
            -&gt;run();

        $this-&gt;taskExec('php')
            -&gt;arg('-l')
            -&gt;arg('src/*')
            -&gt;run();
    }

    // Check coding style
    public function codesniffer()
    {
        $this-&gt;taskExec('vendor/bin/phpcs')
            -&gt;arg('--report=checkstyle')
            -&gt;arg('--report-file=reports/checkstyle.xml')
            -&gt;arg('--standard=PSR2')
            -&gt;arg('--extensions=php')
            -&gt;arg('src')
            -&gt;run();
    }
}

</code></pre>

<p>Each public method in the RoboFile class is interprented as a command. For example to run the lint command, which checks our code for syntax errors, we can run this.</p>

<pre><code class="language-sh">$ vendor/bin/robo lint
</code></pre>

<p>Each command can run one or more tasks. Robo comes with a handful of built in tasks to include running PHPUnit and PHPSpec tests. If there&rsquo;s a task that robo doesn&rsquo;t have, you can use the &lsquo;taskExec&rsquo; task and just give it the command like you would on the command line. Each task has an &lsquo;arg&rsquo; method which just tacks on the various arguments to the command. The &lsquo;run&rsquo; method is pretty self explanatory.</p>

<p>Because robo runs on PHP you can add all kinds of logic to run tasks only when certain conditions are met. I find the syntax and fluent interface to be much more readable than XML as well.</p>

<p>Now that we have a sweet build script we can simplify our config in Jenkins a little bit. Under your project&rsquo;s config in Jenkin&rsquo;s dashboard, in our &lsquo;Execute Shell&rsquo; build step we can add the following.</p>

<pre><code class="language-sh">/usr/local/bin/composer --prefer-source install
vendor/bin/robo build
</code></pre>

<p>That&rsquo;s it! The script will go ahead and create a reports directory for published reports. It will run our tests, check for syntax and even do a code standard check against PSR-2. If you want to try it for yourself, you can grab this sample project I created <a href="https://github.com/ezynda3/string-calculator">here</a>.</p>

<p>You can also check out Robo&rsquo;s excellent documentation <a href="http://robo.li/started/">here</a>.</p>

      <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fedzynda.com%2fcontinuous-integration-with-jenkins-part-ii%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Continuous%20Integration%20With%20Jenkins%20Part%20II&amp;url=http%3a%2f%2fedzynda.com%2fcontinuous-integration-with-jenkins-part-ii%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fedzynda.com%2fcontinuous-integration-with-jenkins-part-ii%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google&#43;"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fedzynda.com%2fcontinuous-integration-with-jenkins-part-ii%2f&title=Continuous%20Integration%20With%20Jenkins%20Part%20II" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

      <h3>Comments</h3>
      <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'edzynda';
    var disqus_identifier = 'http:\/\/edzynda.com\/continuous-integration-with-jenkins-part-ii\/';
    var disqus_title = 'Continuous Integration With Jenkins Part II';
    var disqus_url = 'http:\/\/edzynda.com\/continuous-integration-with-jenkins-part-ii\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
    <div class="col s2 offset-l2">
      <iframe width="100%" height="400" src="https://leanpub.com/aopinphp/embed" frameborder="0" allowtransparency="true"></iframe>
    </div>
  </div>
</div>

<footer class="page-footer red accent-3">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <div class="row valign-wrapper">
            <div class="col s4">
              <img src="http://www.gravatar.com/avatar/6f0ca2846bbe006ad4bc12a583387c6a.png?size=200" class="circle responsive-img">
            </div>
            <div class="col s8">
              <h5 class="white-text">About Me</h5>
              <p class="grey-text text-lighten-4">
                I’m a nine year Air Force veteran and web software engineer with a passion for what makes the Internet tick. I code, I travel, I eat and I'm hungry for more!
              </p>
            </div>
          </div>
        </div>
        <div class="col l3 s12 offset-l3">
          <h5 class="white-text">Connect</h5>
          <ul class="share-buttons">
            <li><a href="//twitter.com/edzynda" class="icon-twitter white-text" target="_blank" title="Twitter"></a></li>
            <li><a href="//github.com/ezynda3" class="icon-github white-text" target="_blank" title="Github"></a></li>
            <li><a href="//instagram.com/yungzee83" class="icon-instagram white-text" target="_blank" title="Instagram"></a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      © 2016 Ed Zynda
      </div>
    </div>
  </footer>


  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="/js/materialize.js"></script>
  <script src="/js/init.js"></script>

  </body>
</html>

