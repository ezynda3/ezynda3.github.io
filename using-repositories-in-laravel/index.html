<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Ed Zynda - Coder, Hacker, Superhero</title>

  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/agate.min.css">
</head>
<body>
  <nav class="red accent-3" role="navigation">
    <div class="nav-wrapper container">
      <a href="/" class="brand-logo">edzynda.com</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="/">Home</a></li>
        <li><a href="https://leanpub.com/u/anonymous0KWqBbeC1178r-jrlQOcux">Books</a></li>
      </ul>
    </div>
  </nav>
  <div class="parallax-container">
    <br>
    <br>
    <br>
    <br>
    <h1 class="header center white-text text-lighten-2">Ed Zynda</h1>
    <h3 class="header center white-text text-lighten-2">Coder | Hacker | Superhero</h3>
    <br>
    <ul class=" header center share-buttons">
      <li><a href="//twitter.com/edzynda" class="icon-twitter white-text" target="_blank" title="Twitter"></li>
      <li><a href="//github.com/ezynda3" class="icon-github white-text" target="_bank" title="Github"></li>
      <li><a href="//instagram.com/yungzee83" class="icon-instagram white-text" target="_blank" title="Instagram"></li>
    </ul>
    <div class="parallax"><img src="/images/parallax.png"></div>
  </div>


<div class="section white container">
  <div class="row">
    <div class="col s8">
      
  
  <h2><a href="http://edzynda.com/using-repositories-in-laravel/" title="Using Repositories In Laravel">Using Repositories In Laravel</a></h2>

  Posted on
  <time datetime="Oct 10, 2013">October 10, 2013</time>
  
    &middot; Tagged in
        
        <div class="chip"><a href="http://edzynda.com/tags/dependency-injection">dependency injection</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/interface">interface</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/ioc">ioc</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/laravel">laravel</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/php">php</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/repository">repository</a></div>
        
        <div class="chip"><a href="http://edzynda.com/tags/tdd">tdd</a></div>
        
    
  

      <p>The past couple of days I have been cramming my brain with coding knowledge. I&#8217;m working on a side project that I&#8217;ll likely announce in detail as it gets closer to launch. Since I&#8217;m starting from an empty Laravel project and building it from the ground up, I&#8217;m learning quite a bit about the framework and even some of the new features in PHP 5.4 and above.</p>

<p>One technique I&#8217;m starting to better understand is that of dependency injection. Dependency injection sounds scary at first but it&#8217;s really a simple concept and has the potential to improve the flexibility of your projects. Laravel allows you to take dependency injection a step further with it&#8217;s powerful IoC container.</p>

<p>If you&#8217;ve frequented web development forums or IRC channels lately, you might hear seasoned veterans blabbing about the merits of TDD or Test Driven Development. It&#8217;s another concept that sounds scary at first but really isn&#8217;t once you start digging into it. Basically TDD preaches that you should write automated tests for your code <strong>before</strong> you even write a single line of production code. Not only that, you should be writing tests that work with a single component at a time, in isolation. If you follow the single responsibility principle when writing code, this shouldn&#8217;t be too hard.</p>

<p>What if your class or controller methods depend on another class that has it&#8217;s own responsibilities? Theoretically those classes should have their own tests and should be isolated from your own tests. How do we do this though? The answer is dependency injection.</p>

<p>Dependency injection is simply passing the classes your current class depends on through the constructor.</p>

<pre><code class="language-php">&lt;?php
class UserController extends BaseController {
    protected $dependency;

    public function __construct(Dependency $dependency)
    {
        $this-&gt;dependency = $dependency;
    }
}
</code></pre>

<p>That&#8217;s it. Not too scary right? This way, when you write your automated tests, you can now &#8216;mock&#8217; those classes with a tool like Mockery and inject them from inside your test code. If those dependencies accessed a database or live filesystem you can rest assured your tests will not because those dependencies are now mocked or stubbed.</p>

<p>So dependency injection is great for testing but it has other benefits. Let&#8217;s say in laravel you have a UserController. That controller has a method that fetches all users and sends them to a view.</p>

<pre><code class="language-php">&lt;?php
class UserController extends BaseController {

    public function index()
    {
        $users = User::all();
        return View::make('users.list', compact($users));
    }
}
</code></pre>

<p>It&rsquo;s very simple to call our User model and just call methods from within the controller. But this will create a nightmare for testing and isn&rsquo;t very flexible. Why not inject the User model?</p>

<pre><code class="language-php">&lt;?php
class UserController extends BaseController {
    protected $user;

    public function __construct(User $user)
    {
        $this-&gt;user = $user;
    }
    public function index()
    {
        $users $this-&gt;user-&gt;all();
        return View::make('users.list', compact($users));
    }
}
</code></pre>

<p>Okay that&#8217;s great but say one day you decide to go with a different implementation of your users like MongoDB or a flatfile database? You&#8217;ll have to go through your code and clean out and refactor anything that references the Laravel models because they extend Eloquent which uses an SQL database. This is where the idea of using repositories comes in.</p>

<p>First let&#8217;s create an interface. Think of an interface as a contract. Any class that implements this interface must also implement its methods.</p>

<pre><code class="language-php">&lt;?php namespace Stark\Repositories;

interface UserRepositoryInterface {
    public function getAll();
}
</code></pre>

<p>We&rsquo;ll store it in a custom directory called &lsquo;Stark/Repositories&rsquo;. Notice that the namespace goes along with the directory structure. Now let&rsquo;s create a class that implements this interface.</p>

<pre><code class="language-php">&lt;?php namespace Stark\Repositories;

use User;

class EloquentUserRepository implements UserRepositoryInterface {
    public function getAll()
    {
        return User::all();
    }
}
</code></pre>

<p>Cool. Now let&rsquo;s just refactor our controller to use our interface.</p>

<pre><code class="language-php">&lt;?php

use Stark\Repositories\UserRespositoryInterface as Repository;

class UserController extends BaseController {
    protected $user;

    public function __construct(Repository $user)
    {
        $this-&gt;user = $user;
    }
    public function index()
    {
        $users $this-&gt;user-&gt;getAll();
        return View::make('users.list', compact($users));
    }
}
</code></pre>

<p>Now remember that interfaces are cannot be instantiated but Laravel is smart enough to inject a proper class in it&#8217;s place if you give it some hints. First we have to make sure our &#8216;Stark&#8217; namespace is autoloaded. For that we edit our composer.json file and add the namespace and it&#8217;s location under &#8220;psr-0&#8243;.</p>

<pre><code class="language-json">{
    &quot;autoload&quot;: {
        &quot;psr-0&quot;: {
            &quot;Stark&quot;: &quot;app/&quot;
        }
    }
}
</code></pre>

<p>Next we tell Laravel that anytime we reference UserRepositoryInterface we really want EloquentUserRepository. We can do that in our &#8216;app/routes.php&#8217; file.</p>

<pre><code class="language-php">&lt;?php
App::bind('Stark\Repositories\UserRepositoryInterface', 'Stark\Repositories\EloquentUserRepository');
</code></pre>

<p>Now if we decide to use some other storage method we can simply code another repository that implements the UserRepositoryInterface and change that one line in the routes file to reflect the change. The rest of your app couldn&#8217;t care less.</p>

      <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fedzynda.com%2fusing-repositories-in-laravel%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Using%20Repositories%20In%20Laravel&amp;url=http%3a%2f%2fedzynda.com%2fusing-repositories-in-laravel%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fedzynda.com%2fusing-repositories-in-laravel%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google&#43;"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fedzynda.com%2fusing-repositories-in-laravel%2f&title=Using%20Repositories%20In%20Laravel" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

      <h3>Comments</h3>
      <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'edzynda';
    var disqus_identifier = 'http:\/\/edzynda.com\/using-repositories-in-laravel\/';
    var disqus_title = 'Using Repositories In Laravel';
    var disqus_url = 'http:\/\/edzynda.com\/using-repositories-in-laravel\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
    <div class="col s2 offset-l2">
      <iframe width="100%" height="400" src="https://leanpub.com/aopinphp/embed" frameborder="0" allowtransparency="true"></iframe>
    </div>
  </div>
</div>

<footer class="page-footer red accent-3">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <div class="row valign-wrapper">
            <div class="col s4">
              <img src="http://www.gravatar.com/avatar/6f0ca2846bbe006ad4bc12a583387c6a.png?size=200" class="circle responsive-img">
            </div>
            <div class="col s8">
              <h5 class="white-text">About Me</h5>
              <p class="grey-text text-lighten-4">
                I’m a nine year Air Force veteran and web software engineer with a passion for what makes the Internet tick. I code, I travel, I eat and I'm hungry for more!
              </p>
            </div>
          </div>
        </div>
        <div class="col l3 s12 offset-l3">
          <h5 class="white-text">Connect</h5>
          <ul class="share-buttons">
            <li><a href="//twitter.com/edzynda" class="icon-twitter white-text" target="_blank" title="Twitter"></a></li>
            <li><a href="//github.com/ezynda3" class="icon-github white-text" target="_blank" title="Github"></a></li>
            <li><a href="//instagram.com/yungzee83" class="icon-instagram white-text" target="_blank" title="Instagram"></a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      © 2016 Ed Zynda
      </div>
    </div>
  </footer>


  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="/js/materialize.js"></script>
  <script src="/js/init.js"></script>

  </body>
</html>

